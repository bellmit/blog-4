[聊一聊 Spring 中的线程安全性](https://zhuanlan.zhihu.com/p/52096028)

我们交由Spring管理的大多数对象其实都是一些`无状态`的对象，这种不会因为多线程而导致状态被破坏的对象很适合Spring的默认scope，每个单例的无状态对象都是线程安全的（**也可以说只要是无状态的对象，不管单例，还是多例都是线程安全的，不过单例毕竟节省了不断创建对象与GC的开销**）。

无状态的对象即是自身没有状态的对象，自然也就不会因为多个线程的交替调度而破坏自身状态导致线程安全问题。无状态对象包括我们经常使用的Service、DAO和Controller，这些对象并没有自己的状态，它们只是用来执行某些操作的。例如，每个DAO提供的函数都只是对数据库的CRUD，而且每个数据库Connection都作为函数的局部变量（局部变量是在用户栈中的`???`，而且用户栈本身就是线程私有的内存区域，所以不存在线程安全问题），用完即关（或交还给连接池）。

通过阅读上文其实已经说的很清楚了，Spring根本就没有对bean的多线程安全问题做出任何保证与措施。对于每个bean的线程安全问题，根本原因是每个bean自身的设计。不要在bean中声明任何有状态的实例变量或类变量，如果必须如此，那么就使用ThreadLocal把变量变为线程私有的，如果bean的实例变量或类变量需要在多个线程之间共享，那么就只能使用synchronized、lock、CAS等这些实现线程同步的方法了。

Spring中的默认单例bean是，并没有对单例bean进行线程安全的封装，单例bean可以分为是否有状态，也就是说是否进行数据存储，无状态情况下，就是不进行数据存储，此时在多线程下是安全的，当有状态时，进行数据存储，是非线程安全，此时可以更改bean的scope属性值为prototype来保证线程安全
